# 新的命名规范和数据链路映射

## 1. 项目概述

本文档定义了影视资源网站前端项目的新命名规范和数据链路映射，旨在消除现有的命名不一致问题，建立清晰、统一的数据流架构。

## 2. 核心问题分析

### 2.1 现有命名混乱问题
- **Topic/Collection 混用**：`TopicItem` 与 `CollectionItem` 并存
- **数据链路错位**：变量名与实际数据类型不匹配
- **API端点不一致**：`/movies/trending` 返回写真数据而非电影数据
- **服务层命名残留**：存在大量 `topic`、`trending` 相关的旧命名

### 2.2 数据链路错位详情
```typescript
// 当前错误的数据链路映射
trendingMovies: PhotoItem[]     // 变量名暗示电影，实际是写真数据
popularMovies: LatestItem[]     // 变量名暗示电影，实际是最新更新数据  
newReleases: HotItem[]          // 变量名暗示新发布，实际是热门数据
```

## 3. 新的命名规范

### 3.1 数据类型统一命名
```typescript
// ✅ 新的统一命名规范
CollectionItem  // 替代所有 TopicItem
PhotoItem       // 保持不变
LatestItem      // 保持不变  
HotItem         // 保持不变
```

### 3.2 变量命名规范
```typescript
// ✅ 新的变量命名（与数据类型对应）
photos: PhotoItem[]           // 替代 trendingMovies
latestUpdates: LatestItem[]   // 替代 popularMovies
hotDaily: HotItem[]           // 替代 newReleases
collections: CollectionItem[] // 替代 collectionsData
```

### 3.3 API端点命名规范
```typescript
// ✅ 新的API端点设计
/photos              // 替代 /movies/trending
/latest-updates      // 新增，对应最新更新数据
/hot-daily          // 新增，对应24小时热门数据
/collections        // 保持不变
```

## 4. 数据链路映射表

### 4.1 完整映射关系
| 旧变量名 | 旧数据类型 | 新变量名 | 新数据类型 | 新API端点 | 对应组件 |
|---------|-----------|---------|-----------|-----------|----------|
| `trendingMovies` | `PhotoItem[]` | `photos` | `PhotoItem[]` | `/photos` | `PhotoSection` |
| `popularMovies` | `LatestItem[]` | `latestUpdates` | `LatestItem[]` | `/latest-updates` | `LatestUpdateSection` |
| `newReleases` | `HotItem[]` | `hotDaily` | `HotItem[]` | `/hot-daily` | `HotSection` |
| `collectionsData` | `TopicItem[]` | `collections` | `CollectionItem[]` | `/collections` | `CollectionSection` |

### 4.2 服务层方法映射
| 旧方法名 | 新方法名 | 说明 |
|---------|---------|------|
| `getTrendingMovies()` | `getPhotos()` | 获取写真数据 |
| `getPopularMovies()` | `getLatestUpdates()` | 获取最新更新数据 |
| `getNewReleases()` | `getHotDaily()` | 获取24小时热门数据 |
| `getTopics()` | `getCollections()` | 获取影片合集数据 |

## 5. 分批重构计划

### 5.1 第一批：核心数据流修正（超高优先级）
**预计时间：1-2小时**

**目标**：修正首页数据链路错位问题

**涉及文件**：
- `src/data/home/homeData.ts`
- `src/presentation/pages/home/HomePage.tsx`
- `src/application/services/HomeApplicationService.ts`

**具体修改**：
```typescript
// homeData.ts
export interface UseHomeDataReturn {
  photos: PhotoItem[]           // 替代 trendingMovies
  latestUpdates: LatestItem[]   // 替代 popularMovies  
  hotDaily: HotItem[]           // 替代 newReleases
  collections: CollectionItem[] // 替代 collectionsData
  isLoading: boolean
  error: string | null
  refetch: () => Promise<void>
}
```

### 5.2 第二批：类型系统重构（高优先级）
**预计时间：2-3小时**

**目标**：统一所有类型定义，消除 Topic/Collection 混用

**涉及文件**：
- `src/types/movie.types.ts`
- `src/types/unified-interfaces.types.ts`
- `src/infrastructure/api/interfaces/IHomeApi.ts`

**具体修改**：
- 将所有 `TopicItem` 替换为 `CollectionItem`
- 更新相关接口和类型导出
- 修正类型引用关系

### 5.3 第三批：服务层重构（高优先级）
**预计时间：3-4小时**

**目标**：重构应用服务和基础设施服务的方法命名

**涉及文件**：
- `src/application/services/HomeApplicationService.ts`
- `src/application/services/MockDataService.ts`
- `src/infrastructure/repositories/HomeRepository.ts`
- `src/infrastructure/api/MockApiService.ts`

**具体修改**：
- 重命名所有服务方法
- 更新方法实现逻辑
- 修正数据转换逻辑

### 5.4 第四批：API层重构（高优先级）
**预计时间：2-3小时**

**目标**：更新API端点和相关配置

**涉及文件**：
- `src/infrastructure/api/endpoints.ts`
- `src/infrastructure/api/movieApi.ts`
- `src/infrastructure/repositories/HomeRepository.ts`

**具体修改**：
```typescript
// endpoints.ts
export const MOVIE_ENDPOINTS = {
  // 旧端点
  // TRENDING: '/movies/trending',
  
  // 新端点
  PHOTOS: '/photos',
  LATEST_UPDATES: '/latest-updates', 
  HOT_DAILY: '/hot-daily',
  COLLECTIONS: '/collections',
}
```

### 5.5 第五批：表现层清理（中优先级）
**预计时间：1-2小时**

**目标**：更新组件中的变量引用和日志输出

**涉及文件**：
- `src/presentation/components/domains/*/`
- `src/utils/data-converters.ts`
- 其他包含旧命名的组件文件

## 6. 执行策略

### 6.1 执行原则
1. **严格按批次执行**：每批次完成后进行测试，确保功能正常
2. **及时提交代码**：每批次完成后立即提交，便于回滚
3. **保持功能完整**：重构过程中确保应用功能不受影响
4. **文档同步更新**：修改代码的同时更新相关注释和文档

### 6.2 测试策略
1. **单元测试**：确保数据转换逻辑正确
2. **集成测试**：验证API调用和数据流
3. **UI测试**：确保页面展示正常
4. **回归测试**：验证现有功能未受影响

### 6.3 风险控制
1. **备份当前代码**：重构前创建分支备份
2. **分步验证**：每个文件修改后立即验证
3. **错误监控**：密切关注控制台错误和网络请求
4. **快速回滚**：出现问题时能够快速回滚到上一个稳定状态

## 7. 预期收益

### 7.1 代码质量提升
- **命名一致性**：消除所有命名混乱问题
- **数据流清晰**：变量名与数据类型完全对应
- **维护性增强**：新开发者能够快速理解代码结构

### 7.2 开发效率提升
- **减少困惑**：开发者不再需要猜测变量的实际含义
- **降低错误率**：类型安全和命名一致性减少运行时错误
- **提升协作效率**：团队成员对数据流有统一理解

### 7.3 系统架构优化
- **API设计合理化**：端点路径与返回数据类型对应
- **服务层职责清晰**：每个服务方法的功能明确
- **组件复用性增强**：统一的数据结构便于组件复用

## 8. 后续维护建议

### 8.1 代码审查规范
- 新增代码必须遵循新的命名规范
- 禁止引入与新规范冲突的命名
- 定期检查是否有命名规范违反

### 8.2 文档维护
- 及时更新API文档
- 维护数据流图和架构文档
- 记录重要的设计决策

### 8.3 持续改进
- 定期评估命名规范的合理性
- 根据业务发展调整数据结构
- 保持与行业最佳实践的同步

---

**重构完成标志**：
- [ ] 所有 `TopicItem` 替换为 `CollectionItem`
- [ ] 所有数据链路变量名与类型对应
- [ ] 所有API端点路径与返回数据匹配
- [ ] 所有服务方法命名语义化
- [ ] 控制台无命名相关错误
- [ ] 页面功能完全正常