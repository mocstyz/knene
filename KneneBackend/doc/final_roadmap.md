# 🎯 电影网站系统最终开发路线图（单体架构优化版）

## 概述

基于对原路线图的全面检查和优化，形成最终可执行的开发方案。核心改进原则：
- **增量式数据库设计 + 核心表先行**
- **领域模型优先于基础架构实现**
- **埋点系统早期建立，分阶段实施**
- **保持业务功能依赖关系的正确性**

## 📋 第一阶段：数据层与基础架构（10-12周）

### 1.1 核心数据库架构设计（2周）
- ✅ 用户核心表设计：users, user_profiles, roles, permissions
- ✅ 系统配置表设计：system_configs, dictionaries, file_storages
- ✅ 审计和日志表设计：operation_logs, audit_logs
- ✅ 数据库架构规范制定

### 1.2 领域模型设计（2周）**【顺序调整】**
- ✅ 用户领域模型：User领域实体、Repository接口、Service接口
- ✅ 资源领域模型：Resource核心实体、Repository接口、Service接口
- ✅ 内容领域模型：Article、WikiEntry领域模型
- ✅ VIP领域模型：VipMembership、Order领域模型

**理由**：基础架构的实现需要依赖领域模型的接口定义

### 1.3 基础架构层（2周）
- ✅ 核心配置模块：项目骨架、应用配置、日志系统
- ✅ 缓存基础设施设计：Redis配置、连接池、序列化策略
- ✅ 数据访问基础架构：Druid连接池、MyBatis-Plus配置、Flyway集成
- ✅ 安全基础设施：密码加密、JWT工具、安全过滤器

### 1.4 埋点技术架构设计（0.5周）**【新增】**
- 🎯 埋点SDK架构设计：统一埋点接口设计
- 🎯 GA4 + Hotjar集成方案：数据收集架构设计
- 🎯 数据流向设计：前端 → GA4/Hotjar → Data Studio
- 🎯 埋点规范和事件定义：标准化事件命名和参数

### 1.5 基础埋点实施（0.5周）**【新增】**
- 🎯 统一埋点SDK开发：封装GA4和Hotjar集成
- 🎯 基础事件追踪：页面浏览、用户信息、设备信息
- 🎯 错误监控埋点：JavaScript错误、API错误
- 🎯 性能监控埋点：页面加载时间、API响应时间
- 🎯 GA4/Hotjar基础配置：账户设置和初始化

### 1.6 测试基础设施（1周）
- ✅ 测试环境搭建：单元测试、集成测试环境配置
- ✅ Instancio数据生成器集成：用户、资源、内容等实体模板开发

### 1.7 集成测试与文档完善（1.5周）
- ✅ 第一阶段功能集成测试：基础架构组件测试
- ✅ API文档生成：SpringDoc OpenAPI配置
- ✅ 数据库设计文档完善：表结构说明和关系图
- 🎯 埋点规范文档和培训：团队埋点技能培训

### 1.8 埋点系统培训（0.5周）
- 🎯 埋点SDK使用培训：开发团队技能培训
- 🎯 埋点规范讲解：事件命名和数据格式规范
- 🎯 前端埋点代码规范：代码集成最佳实践

---

## 📋 第二阶段：核心功能实现（8-10周）

### 2.1 认证权限数据库设计与实施（0.5周）
- ✅ 认证系统表设计：user_roles, refresh_tokens, login_history
- ✅ 权限管理表设计：user_permissions, role_permissions
- ✅ 安全相关表设计：failed_login_attempts, user_lockouts

### 2.2 用户认证与权限系统实现（2周）
- ✅ 后端：认证核心模块（注册、登录、账户验证）
- ✅ 后端：权限管理模块（角色管理、动态权限控制）
- ✅ 后端：用户管理模块（用户信息管理、状态管理）
- ✅ 前端：认证系统适配（登录、注册、密码重置页面）
- ✅ 前端：认证功能集成开发（状态管理、API调用）
- ✅ 前端：权限系统适配（路由守卫、权限控制组件）

### 2.3 用户认证埋点实施（0.5周）**【新增】**
- 🎯 登录/注册/登出事件埋点：认证流程追踪
- 🎯 权限验证事件埋点：权限验证失败/成功
- 🎯 密码重置/修改事件埋点：密码操作追踪
- 🎯 认证错误事件埋点：错误类型和频率分析
- 🎯 用户认证流程漏斗分析：转化率分析

### 2.4 缓存策略实施（1周）**【修正】**
- ✅ 用户会话缓存实施：登录状态、权限信息缓存
- ✅ 系统配置缓存实施：配置项、字典数据缓存
- ✅ 缓存中间件集成：Spring Cache注解配置
- ✅ 前端缓存策略适配：与后端TTL同步的缓存策略

### 2.5 资源管理数据库设计与实施（0.5周）
- ✅ 资源核心表设计：resources, resource_categories, resource_tags
- ✅ 爬虫相关表设计：crawl_tasks, crawl_sources, crawl_logs
- ✅ 图片管理表设计：images, image_categories

### 2.6 资源模型与基础管理（1.5周）
- ✅ 基础爬虫框架：爬虫抽象层、HTTP工具模块、任务调度系统
- ✅ 普通资源爬取模块：TorrentGalaxy爬虫、IMDB信息集成
- ✅ 图片处理模块：图片下载、图床上传、图片缓存管理
- ✅ 后端：资源管理模块（资源创建更新、查询功能、分类管理）
- ✅ 前端：资源展示系统适配（首页、详情页、分类页、搜索功能）

### 2.7 资源浏览埋点实施（0.5周）**【新增】**
- 🎯 资源浏览/搜索事件埋点：浏览行为和搜索关键词
- 🎯 资源详情查看事件埋点：用户兴趣点分析
- 🎯 资源分类筛选事件埋点：用户偏好分析
- 🎯 资源收藏/分享事件埋点：用户互动行为
- 🎯 资源搜索关键词埋点：热门搜索词分析

### 2.8 内容管理数据库设计与实施（0.5周）
- ✅ 文章管理表设计：articles, article_categories, article_comments
- ✅ Wiki知识库表设计：wiki_entries, wiki_categories, wiki_versions

### 2.9 内容管理基础功能（1.5周）
- ✅ 后端：新闻管理模块（文章CRUD、分类标签、评论互动）
- ✅ 后端：WIKI知识库模块（知识点管理、搜索功能、用户贡献）
- ✅ 前端：新闻公告系统适配（列表页、详情页、分类页）
- ✅ 前端：帮助文档系统适配（首页、目录页、详情页、搜索页）

### 2.10 内容浏览埋点实施（0.5周）**【新增】**
- 🎯 新闻文章浏览事件埋点：内容阅读行为
- 🎯 Wiki知识查看事件埋点：学习行为分析
- 🎯 帮助文档搜索事件埋点：用户求助行为
- 🎯 内容互动事件埋点：点赞、评论、分享行为

---

## 📋 第三阶段：业务功能扩展（10-12周）

### 3.1 VIP系统数据库设计与实施（0.5周）
- ✅ VIP会员相关表设计：vip_memberships, vip_plans, vip_benefits
- ✅ 订单系统表设计：orders, order_items, payment_records
- ✅ 营销活动表设计：coupons, user_coupons, promotions

### 3.2 VIP系统与支付功能实现（2周）
- ✅ 后端：会员管理模块（等级体系、状态管理、特权控制）
- ✅ 后端：支付系统模块（支付通道集成、订单管理、通知处理）
- ✅ 后端：营销活动模块（优惠券系统、促销活动、会员推荐）
- ✅ 前端：VIP会员系统适配（会员介绍、购买页面、会员中心）
- ✅ 前端：支付系统适配（支付选择、订单确认、支付处理）

### 3.3 VIP系统与支付功能埋点（0.5周）**【新增】**
- 🎯 VIP页面浏览事件埋点：VIP功能关注度
- 🎯 VIP套餐查看/比较事件埋点：用户选择偏好
- 🎯 支付流程事件埋点：支付流程转化率
- 🎯 支付成功/失败事件埋点：支付成功率分析
- 🎯 VIP激活/使用事件埋点：VIP功能使用情况

### 3.4 种子文件与PT站点数据库设计（0.5周）
- ✅ 种子文件处理表设计：torrent_files, torrent_file_lists, torrent_trackers
- ✅ 磁力链接表设计：magnet_links, magnet_metadata
- ✅ PT站点集成表设计：pt_sites, pt_accounts, pt_account_stats

### 3.5 种子文件与PT站点系统实施（1.5周）
- ✅ 后端：种子文件处理模块（种子解析、健康度评估、磁力链接管理）
- ✅ 后端：PT站点集成模块（账户管理、数据采集、风险控制）
- ✅ 后端：PT下载任务管理（任务调度、做种管理、站点优化）
- ✅ 前端：种子文件管理页面适配（列表页、详情页、健康度监控）
- ✅ 前端：PT站点管理页面适配（账户页面、监控页面、下载任务管理）

### 3.6 PT站点管理埋点（0.5周）**【新增】**
- 🎯 PT站点管理页面浏览埋点：管理功能使用情况
- 🎯 下载任务管理事件埋点：任务操作行为
- 🎯 做种任务监控事件埋点：做种行为分析
- 🎯 分享率预警事件埋点：风险关注程度

### 3.7 资源求片埋点（0.5周）**【新增】**
- 🎯 求片请求提交事件埋点：用户需求分析
- 🎯 求片状态查看事件埋点：关注程度分析
- 🎯 VIP下载使用事件埋点：VIP特权使用情况

### 3.8 其他业务功能
- ✅ 网盘集成（1.5周）：115网盘API、离线下载、文件管理
- ✅ 广告系统（1周）：广告位管理、投放策略、联盟对接
- ✅ 图床服务（1周）：多图床支持、图片优化、管理功能

---

## 📋 第四阶段：用户中心与消息系统（4-5周）

### 4.1 用户中心数据库设计与实施（1周）
- ✅ 个人中心相关表设计：user_profiles_detailed, user_settings
- ✅ 历史记录表设计：download_history, browse_history, search_history
- ✅ 收藏管理表设计：favorites, favorite_folders, favorite_shares

### 4.2 个人中心系统（1.5周）
- ✅ 后端：个人资料管理模块（个人信息、用户偏好、状态展示）
- ✅ 后端：用户历史记录模块（下载历史、浏览历史、搜索历史）
- ✅ 后端：用户收藏管理模块（收藏功能、收藏夹管理、分享功能）
- ✅ 前端：个人中心页面适配（资料页面、设置页面、状态页面）
- ✅ 前端：用户历史页面适配（下载历史、浏览历史、搜索历史）
- ✅ 前端：收藏管理页面适配（收藏夹页面、分类页面、分享页面）

### 4.3 个人中心埋点实施（0.5周）**【新增】**
- 🎯 个人资料页面浏览埋点：个人功能使用情况
- 🎯 个人信息修改事件埋点：用户活跃度分析
- 🎯 历史记录查看事件埋点：用户回顾行为
- 🎯 收藏夹管理事件埋点：用户收藏偏好

### 4.4 消息通知数据库设计与实施（0.5周）
- ✅ 消息系统表设计：messages, message_types, user_message_status
- ✅ 推送系统表设计：push_subscriptions, notification_settings
- ✅ 工单系统表设计：tickets, ticket_categories, ticket_replies

### 4.5 消息通知系统（1.5周）
- ✅ 后端：通知系统实现（通知类型、存储查询、发送功能、状态管理）
- ✅ 后端：消息推送模块（站内消息、邮件通知、推送策略）
- ✅ 后端：工单系统模块（工单管理、用户反馈、处理流程）
- ✅ 前端：消息通知系统适配（消息中心、详情页面、设置页面）
- ✅ 前端：工单系统页面适配（创建页面、列表页面、详情页面）

### 4.6 消息通知埋点实施（0.5周）**【新增】**
- 🎯 消息中心浏览埋点：消息关注度分析
- 🎯 消息查看/删除事件埋点：消息处理行为
- 🎯 消息设置修改事件埋点：用户偏好变化
- 🎯 工单系统使用埋点：用户求助行为

---

## 📋 第五阶段：数据分析与系统管理（5-6周）

### 5.1 搜索推荐数据库设计与实施（0.5周）
- ✅ 搜索系统表设计：search_logs, search_suggestions, popular_searches
- ✅ 推荐系统表设计：user_recommendations, user_behaviors, item_similarities
- ✅ 管理后台表设计：admin_users, admin_permissions, admin_operation_logs
- ✅ 统计分析表设计：user_statistics, resource_statistics, system_statistics

### 5.2 搜索系统与推荐功能（1周）
- ✅ 基础搜索模块：搜索引擎抽象层、数据库搜索、搜索缓存
- ✅ 全文搜索模块：Elasticsearch集成、基础搜索功能、数据同步
- ✅ 搜索增强功能：搜索建议系统、搜索历史功能
- ✅ 前端：搜索系统适配（搜索首页、结果页面、高级搜索、建议组件）

### 5.3 搜索推荐埋点实施（0.5周）**【新增】**
- 🎯 搜索关键词输入/建议点击埋点：搜索行为分析
- 🎯 搜索结果点击埋点：搜索效果分析
- 🎯 搜索筛选使用埋点：用户搜索偏好
- 🎯 推荐内容点击埋点：推荐算法效果

### 5.4 后台管理系统（1周）
- ✅ 后端：管理后台核心模块（管理员权限、用户管理、资源管理）
- ✅ 后端：系统监控模块（系统状态监控、业务数据监控）
- ✅ 后端：内容管理模块（内容审核、系统配置）
- ✅ 前端：管理后台页面适配（仪表板、用户管理、资源管理、系统监控）

### 5.5 管理后台埋点实施（0.5周）**【新增】**
- 🎯 管理后台功能使用埋点：管理功能使用情况
- 🎯 管理操作事件埋点：管理员操作行为
- 🎯 批量操作事件埋点：批量操作频率
- 🎯 数据导出事件埋点：数据使用需求

### 5.6 数据统计与分析（1周）
- ✅ 后端：用户行为统计（访问统计、交互统计、用户画像）
- ✅ 后端：资源统计分析（热度分析、质量分析、运营分析）
- ✅ 后端：业务运营分析（会员业务、积分业务）
- ✅ 前端：数据报表页面适配（统计首页、用户分析、资源分析、业务分析）

### 5.7 数据分析完善（1周）**【新增】**
- 🎯 GA4数据报表完善：用户行为分析报表
- 🎯 Hotjar热力图分析：用户交互热点分析
- 🎯 用户行为漏斗分析：关键流程转化分析
- 🎯 埋点数据质量验证：数据准确性和完整性检查
- 🎯 业务指标监控看板：核心业务指标实时监控

---

## 📋 第六阶段：性能优化与部署运维（4-6周）

### 6.1 性能优化与缓存系统（1.5周）
- ✅ 缓存架构优化：本地缓存、缓存性能优化、分布式锁优化
- ✅ 数据库性能优化：SQL查询优化、连接池优化、架构优化
- ✅ 应用性能优化：JVM调优、Spring Boot优化、接口优化
- ✅ 前端性能优化适配：页面加载优化、资源优化、交互优化

### 6.2 安全防护数据库设计与实施（0.5周）
- ✅ 反爬虫相关表设计：ip_blacklist, crawler_signatures, protection_rules
- ✅ 安全防护数据迁移脚本：反爬虫表创建、防护规则初始化

### 6.3 安全加固与监控告警（1周）
- ✅ 安全加固措施：认证安全增强、数据安全保护、接口安全防护
- ✅ 反爬虫模块：请求频率限制、行为分析系统、封禁管理系统
- ✅ 监控告警体系：应用监控、基础设施监控、告警机制
- ✅ 日志审计系统：日志收集分析、审计日志管理
- ✅ 前端安全适配：前端安全加固、安全检测适配

### 6.4 部署运维体系（1.5周）
- ✅ 环境管理：环境配置管理、基础设施即代码
- ✅ 部署策略实施：CI/CD流水线构建、发布策略
- ✅ 运维自动化：自动化部署、配置管理、容器化运维
- ✅ 前端运维适配：前端部署优化、前端监控集成

### 6.5 最终集成测试（0.5周）
- ✅ 端到端功能测试：完整用户操作流程测试
- ✅ 性能压力测试：并发性能和响应时间测试
- ✅ 安全渗透测试：安全漏洞扫描和修复
- ✅ 部署验证测试：生产环境部署验证

---

## 📊 时间规划总结

### 最终时间对比表

| 阶段 | 原计划 | 最终方案 | 主要调整内容 |
|------|--------|----------|-------------|
| 第一阶段 | 10-12周 | 10-12周 | 调整内部顺序，增加埋点基础设施 |
| 第二阶段 | 8-10周 | 8-10周 | 增加认证、资源、内容埋点实施 |
| 第三阶段 | 10-12周 | 10-12周 | 增加VIP、PT、求片埋点实施 |
| 第四阶段 | 3-4周 | 4-5周 | 增加用户中心、消息埋点实施 |
| 第五阶段 | 4-5周 | 5-6周 | 增加搜索、管理、数据分析埋点 |
| 第六阶段 | 4-6周 | 4-6周 | 保持不变 |
| **总计** | **39-49周** | **41-51周** | **增加2周埋点系统** |

### 时间增加的合理性分析

**增加的2周时间分配：**
- 第一阶段：埋点基础设施（1周）
- 第二阶段：认证、资源、内容埋点（1周）
- 第三阶段：VIP、PT、求片埋点（已包含在原时间内）
- 第四阶段：用户中心、消息埋点（已包含在原时间内）
- 第五阶段：搜索、管理、数据分析埋点（已包含在原时间内）

**价值回报：**
1. 从项目第一天开始收集用户数据
2. 避免后期大规模前端代码修改
3. 基于数据驱动的产品迭代决策
4. 埋点与开发同步，降低出错风险

## 🎯 埋点系统分层架构

### 基础埋点层（第一阶段）
- **技术埋点**：页面浏览事件、错误监控事件、性能监控事件、用户基础信息
- **基础设施**：埋点SDK、GA4/Hotjar集成、数据收集架构

### 业务埋点层（第二至四阶段）
- **用户行为**：认证流程埋点、资源浏览埋点、VIP购买埋点、用户交互埋点
- **业务指标**：功能使用率、转化率、用户活跃度

### 分析埋点层（第五阶段）
- **高级分析**：搜索推荐埋点、管理操作埋点、转化漏斗埋点、业务指标埋点
- **数据产品**：用户画像、行为分析、业务报表

## ✅ 最终方案的核心优势

### 技术层面
1. **依赖关系清晰**：解决了原方案的循环依赖问题
2. **架构层次分明**：基础→业务→分析的清晰演进路径
3. **埋点与开发同步**：避免后期大规模代码修改
4. **质量保证完善**：每个阶段都有集成测试和埋点验证

### 业务层面
1. **数据驱动决策**：从项目第一天开始收集用户数据
2. **快速迭代支持**：埋点数据指导产品优化方向
3. **用户体验优化**：基于实际行为数据改进功能
4. **运营效率提升**：完整的用户行为分析基础

### 管理层面
1. **风险可控**：增量式实施，每个阶段都有明确交付
2. **团队协作友好**：埋点规范统一，减少沟通成本
3. **进度可预期**：时间规划合理，依赖关系明确
4. **质量可保证**：完整的测试和埋点验证体系

## 📋 实施建议

### 立即执行（第一阶段调整）
1. **修正阶段结构**：按新的8个模块重新组织
2. **埋点基础设施**：建立埋点SDK和基础事件追踪
3. **团队培训**：确保全员掌握埋点规范

### 后续执行（第二至六阶段）
1. **同步实施埋点**：每个功能模块完成后立即实施埋点
2. **持续数据验证**：确保埋点数据质量和完整性
3. **迭代优化**：基于数据反馈调整埋点策略

## ✅ 结论

这个最终方案解决了原路线图的所有主要问题：

1. **✅ 修正了技术实现顺序错误**：领域模型优先于基础架构
2. **✅ 优化了数据库设计策略**：增量式设计+核心表先行
3. **✅ 正确整合了埋点系统**：从第一阶段开始，分步实施
4. **✅ 修正了时间规划和依赖关系**：清晰的依赖链和合理的时间分配
5. **✅ 建立了完整的数据驱动开发体系**：从基础设施到高级分析

**同时保持了所有优点：**
- 业务功能依赖关系正确
- 增量式开发策略合理
- 现代化技术栈选择
- 完善的质量保证体系

**最终形成了一个技术先进、业务合理、数据驱动、可执行的现代化单体架构开发路线图。**