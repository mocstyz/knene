# æ•°æ®åº“ç´¢å¼•è®¾è®¡æŒ‡å¯¼åŸåˆ™

## ğŸ—„ï¸ æ•°æ®åº“ç´¢å¼•è®¾è®¡æŒ‡å¯¼

æœ¬æ–‡æ¡£è¯¦ç»†å®šä¹‰å½±è§†èµ„æºä¸‹è½½ç½‘ç«™æ•°æ®åº“ç´¢å¼•è®¾è®¡çš„åŸåˆ™ã€ç­–ç•¥å’Œæœ€ä½³å®è·µï¼Œä¸ºæ‰€æœ‰æ•°æ®åº“è¡¨çš„ç´¢å¼•è®¾è®¡æä¾›æŒ‡å¯¼ï¼Œç¡®ä¿æŸ¥è¯¢æ€§èƒ½å’Œæ•°æ®è®¿é—®æ•ˆç‡çš„æœ€ä¼˜åŒ–ã€‚

---

## ğŸ¯ ç´¢å¼•è®¾è®¡ç›®æ ‡ä¸åŸåˆ™

### 1.1.1 é˜¶æ®µç›®æ ‡
ä¸ºé¡¹ç›®ç¬¬ä¸€é˜¶æ®µå»ºç«‹å®Œæ•´çš„ç´¢å¼•è®¾è®¡æŒ‡å¯¼åŸåˆ™ï¼ŒåŒ…æ‹¬ï¼š
- ç´¢å¼•è®¾è®¡åŸºæœ¬åŸåˆ™
- ç´¢å¼•ç±»å‹é€‰æ‹©ç­–ç•¥
- ç´¢å¼•æ€§èƒ½ä¼˜åŒ–æ–¹æ³•
- ç´¢å¼•ç»´æŠ¤å’Œç®¡ç†ç­–ç•¥

### è®¾è®¡åŸåˆ™

#### æ€§èƒ½ä¼˜å…ˆåŸåˆ™
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šç´¢å¼•è®¾è®¡ä¼˜å…ˆè€ƒè™‘å¸¸ç”¨æŸ¥è¯¢åœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–
- **å†™å…¥å¹³è¡¡**ï¼šåœ¨æŸ¥è¯¢æ€§èƒ½å’Œå†™å…¥æ€§èƒ½ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹
- **èµ„æºèŠ‚çº¦**ï¼šé¿å…è¿‡åº¦ç´¢å¼•ï¼Œå‡å°‘å­˜å‚¨ç©ºé—´å’Œç»´æŠ¤å¼€é”€

#### ä¸šåŠ¡å¯¼å‘åŸåˆ™
- **æ ¸å¿ƒä¸šåŠ¡ä¼˜å…ˆ**ï¼šä¸ºé«˜é¢‘è®¿é—®çš„æ ¸å¿ƒä¸šåŠ¡æ•°æ®ä¼˜å…ˆå»ºç«‹ç´¢å¼•
- **ç”¨æˆ·ä½“éªŒä¿éšœ**ï¼šç¡®ä¿ç”¨æˆ·å¸¸ç”¨æ“ä½œçš„å“åº”é€Ÿåº¦
- **ä¸šåŠ¡æ‰©å±•æ”¯æŒ**ï¼šä¸ºæœªæ¥ä¸šåŠ¡æ‰©å±•é¢„ç•™ç´¢å¼•ä¼˜åŒ–ç©ºé—´

#### å¯ç»´æŠ¤æ€§åŸåˆ™
- **å‘½åè§„èŒƒ**ï¼šç»Ÿä¸€çš„ç´¢å¼•å‘½åè§„èŒƒï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤
- **æ–‡æ¡£å®Œå–„**ï¼šæ¯ä¸ªç´¢å¼•éƒ½æœ‰æ˜ç¡®çš„ç”¨é€”å’Œè®¾è®¡è¯´æ˜
- **ç›‘æ§æœºåˆ¶**ï¼šå»ºç«‹ç´¢å¼•ä½¿ç”¨æƒ…å†µçš„ç›‘æ§å’Œåˆ†ææœºåˆ¶

---

## ğŸ” ç´¢å¼•ç±»å‹ä¸é€‰æ‹©ç­–ç•¥

### 1. ç´¢å¼•ç±»å‹åˆ†æ

#### ä¸»é”®ç´¢å¼• (Primary Index)
```sql
-- è‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨å®šä¹‰
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
    -- å…¶ä»–å­—æ®µ...
);
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- æ¯ä¸ªè¡¨çš„å”¯ä¸€æ ‡è¯†ç¬¦
- èšç°‡ç´¢å¼•çš„æ•°æ®ç»„ç»‡åŸºç¡€
- å…¶ä»–è¡¨çš„å¤–é”®å…³è”ç›®æ ‡

**è®¾è®¡è¦ç‚¹ï¼š**
- ä½¿ç”¨è‡ªå¢æ•´æ•°ä½œä¸ºä¸»é”®
- é¿å…ä½¿ç”¨ä¸šåŠ¡å­—æ®µä½œä¸ºä¸»é”®
- ä¿æŒä¸»é”®çš„ç¨³å®šæ€§å’Œç®€æ´æ€§

#### å”¯ä¸€ç´¢å¼• (Unique Index)
```sql
-- å•å­—æ®µå”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX uk_users_username ON users(username);
CREATE UNIQUE INDEX uk_users_email ON users(email);

-- å¤åˆå”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX uk_user_roles_user_role ON user_roles(user_id, role_id);
CREATE UNIQUE INDEX uk_resource_categories_resource_category ON resource_categories(resource_id, category_id);
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- ä¸šåŠ¡å”¯ä¸€æ€§çº¦æŸï¼ˆç”¨æˆ·åã€é‚®ç®±ã€è®¢å•å·ç­‰ï¼‰
- å¤šå¯¹å¤šå…³ç³»çš„é˜²é‡å¤çº¦æŸ
- ä¸šåŠ¡è§„åˆ™çš„æ•°æ®åº“å±‚é¢ä¿è¯

**è®¾è®¡è¦ç‚¹ï¼š**
- åŸºäºä¸šåŠ¡è§„åˆ™ç¡®å®šå”¯ä¸€æ€§å­—æ®µ
- å¤åˆå”¯ä¸€ç´¢å¼•çš„å­—æ®µé¡ºåºè¦åˆç†
- è€ƒè™‘æŸ¥è¯¢æ€§èƒ½å’Œçº¦æŸæ•ˆæœ

#### æ™®é€šç´¢å¼• (Regular Index)
```sql
-- å•å­—æ®µç´¢å¼•
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_articles_created_at ON articles(created_at);
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_users_status_created ON users(status, created_at);
CREATE INDEX idx_articles_category_status ON articles(category_id, status);
CREATE INDEX idx_operation_logs_user_type_time ON operation_logs(user_id, operation_type, created_at);
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- ç»å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ
- æ’åºæ“ä½œçš„å­—æ®µ
- åˆ†ç»„æŸ¥è¯¢çš„å­—æ®µ
- JOINæ“ä½œçš„å…³è”å­—æ®µ

#### å‰ç¼€ç´¢å¼• (Prefix Index)
```sql
-- é•¿å­—ç¬¦ä¸²å­—æ®µçš„å‰ç¼€ç´¢å¼•
CREATE INDEX idx_articles_title_prefix ON articles(title(50));
CREATE INDEX idx_content_body_prefix ON content(body(100));
CREATE INDEX idx_users_email_prefix ON users(email(20));
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- é•¿æ–‡æœ¬å­—æ®µçš„æœç´¢ä¼˜åŒ–
- å­˜å‚¨ç©ºé—´æœ‰é™çš„åœºæ™¯
- æŸ¥è¯¢ç²¾åº¦è¦æ±‚ä¸é«˜çš„åœºæ™¯

**è®¾è®¡è¦ç‚¹ï¼š**
- é€‰æ‹©åˆé€‚çš„å‰ç¼€é•¿åº¦
- å¹³è¡¡æŸ¥è¯¢ç²¾åº¦å’Œå­˜å‚¨ç©ºé—´
- è€ƒè™‘å­—ç¬¦é›†çš„å½±å“

#### å…¨æ–‡ç´¢å¼• (Full-Text Index)
```sql
-- MySQL 5.6+ æ”¯æŒå…¨æ–‡ç´¢å¼•
CREATE FULLTEXT INDEX ft_articles_title_content ON articles(title, content);
CREATE FULLTEXT INDEX ft_resources_description ON resources(description);
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- æ–‡ç« å†…å®¹çš„å…¨æ–‡æœç´¢
- èµ„æºæè¿°çš„å…³é”®è¯æœç´¢
- éœ€è¦è‡ªç„¶è¯­è¨€æœç´¢çš„åœºæ™¯

---

## ğŸ“Š ç´¢å¼•è®¾è®¡ç­–ç•¥

### 1. å­—æ®µé€‰æ‹©ç­–ç•¥

#### å¿…é¡»å»ºç«‹ç´¢å¼•çš„å­—æ®µ
```sql
-- 1. ä¸»é”®å­—æ®µï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
-- 2. å¤–é”®å­—æ®µ
CREATE INDEX idx_user_profiles_user_id ON user_profiles(user_id);
CREATE INDEX idx_articles_user_id ON articles(user_id);
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- 3. å”¯ä¸€å­—æ®µ
CREATE UNIQUE INDEX uk_users_username ON users(username);
CREATE UNIQUE INDEX uk_users_email ON users(email);
CREATE UNIQUE INDEX uk_orders_order_no ON orders(order_no);

-- 4. é«˜é¢‘æŸ¥è¯¢å­—æ®µ
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_articles_category_id ON articles(category_id);
CREATE INDEX idx_resources_type ON resources(resource_type);

-- 5. æ—¶é—´å­—æ®µï¼ˆç»å¸¸ç”¨äºèŒƒå›´æŸ¥è¯¢å’Œæ’åºï¼‰
CREATE INDEX idx_users_created_at ON users(created_at);
CREATE INDEX idx_articles_publish_date ON articles(publish_date);
CREATE INDEX idx_orders_created_at ON orders(created_at);
```

#### æ¡ä»¶æ€§ç´¢å¼•å­—æ®µ
```sql
-- æ ¹æ®ä¸šåŠ¡æŸ¥è¯¢æ¨¡å¼å†³å®š
-- 1. çŠ¶æ€å­—æ®µï¼ˆå¦‚æœæœ‰å¤šç§çŠ¶æ€çš„æŸ¥è¯¢ï¼‰
CREATE INDEX idx_articles_status ON articles(status);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_downloads_status ON downloads(status);

-- 2. åˆ†ç±»å­—æ®µï¼ˆå¦‚æœç»å¸¸æŒ‰åˆ†ç±»æŸ¥è¯¢ï¼‰
CREATE INDEX idx_articles_category_id ON articles(category_id);
CREATE INDEX idx_resources_category_id ON resources(category_id);
CREATE INDEX idx_files_category_id ON files(category_id);

-- 3. æ’åºå­—æ®µï¼ˆå¦‚æœç»å¸¸éœ€è¦æ’åºï¼‰
CREATE INDEX idx_articles_sort_order ON articles(sort_order);
CREATE INDEX idx_comments_created_at ON comments(created_at);
CREATE INDEX idx_resources_download_count ON resources(download_count);
```

### 2. å¤åˆç´¢å¼•è®¾è®¡ç­–ç•¥

#### å­—æ®µé¡ºåºåŸåˆ™
```sql
-- 1. é«˜é€‰æ‹©æ€§å­—æ®µåœ¨å‰
CREATE INDEX idx_users_status_created ON users(status, created_at);
-- statuså­—æ®µé€‰æ‹©æ€§é«˜ï¼Œæ”¾åœ¨å‰é¢
-- æŸ¥è¯¢ï¼šWHERE status = 'ACTIVE' AND created_at > '2024-01-01'

-- 2. è¦†ç›–å¸¸ç”¨æŸ¥è¯¢ç»„åˆ
CREATE INDEX idx_operation_logs_user_type_time ON operation_logs(user_id, operation_type, created_at);
-- è¦†ç›–æŸ¥è¯¢ï¼šç”¨æˆ·æ“ä½œè®°å½•ï¼ˆç”¨æˆ·ID + æ“ä½œç±»å‹ + æ—¶é—´èŒƒå›´ï¼‰

-- 3. è€ƒè™‘æ’åºå­—æ®µ
CREATE INDEX idx_articles_category_status_publish ON articles(category_id, status, publish_date);
-- è¦†ç›–æŸ¥è¯¢ï¼šåˆ†ç±»æ–‡ç« åˆ—è¡¨ï¼ˆåˆ†ç±» + çŠ¶æ€ + å‘å¸ƒæ—¶é—´æ’åºï¼‰

-- 4. æœ€å·¦å‰ç¼€åŸåˆ™
CREATE INDEX idx_orders_user_status_created ON orders(user_id, status, created_at);
-- å¯ä»¥æ”¯æŒä»¥ä¸‹æŸ¥è¯¢ï¼š
-- WHERE user_id = ? (âœ“)
-- WHERE user_id = ? AND status = ? (âœ“)
-- WHERE user_id = ? AND status = ? AND created_at > ? (âœ“)
-- WHERE status = ? (âœ—) - ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™
```

#### å¤åˆç´¢å¼•è®¾è®¡ç¤ºä¾‹
```sql
-- ç”¨æˆ·ç›¸å…³çš„å¤åˆç´¢å¼•
CREATE INDEX idx_users_status_created ON users(status, created_at);
CREATE INDEX idx_users_type_status ON users(user_type, status);
CREATE INDEX idx_users_last_login ON users(last_login_at DESC);

-- æ–‡ç« ç›¸å…³çš„å¤åˆç´¢å¼•
CREATE INDEX idx_articles_category_status_publish ON articles(category_id, status, publish_date DESC);
CREATE INDEX idx_articles_author_status ON articles(author_id, status);
CREATE INDEX idx_articles_tags_status ON articles(tag_id, status, created_at DESC);

-- è®¢å•ç›¸å…³çš„å¤åˆç´¢å¼•
CREATE INDEX idx_orders_user_status_created ON orders(user_id, status, created_at DESC);
CREATE INDEX idx_orders_status_amount ON orders(status, amount);
CREATE INDEX idx_orders_payment_status ON orders(payment_method, status);

-- èµ„æºç›¸å…³çš„å¤åˆç´¢å¼•
CREATE INDEX idx_resources_category_type_status ON resources(category_id, resource_type, status);
CREATE INDEX idx_resources_hotness_created ON resources(hotness_score DESC, created_at DESC);
CREATE INDEX idx_resources_size_type ON resources(file_size, resource_type);
```

### 3. é¿å…è¿‡åº¦ç´¢å¼•

#### é‡å¤ç´¢å¼•è¯†åˆ«
```sql
-- âŒ é”™è¯¯ï¼šé‡å¤çš„ç´¢å¼•è®¾è®¡
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_status_created ON users(status, created_at);
-- ç¬¬ä¸€ä¸ªç´¢å¼•æ˜¯å¤šä½™çš„ï¼Œå¤åˆç´¢å¼•å·²ç»å¯ä»¥è¦†ç›–å•å­—æ®µæŸ¥è¯¢

-- âŒ é”™è¯¯ï¼šåŠŸèƒ½é‡å¤çš„ç´¢å¼•
CREATE INDEX idx_articles_title ON articles(title);
CREATE INDEX idx_articles_title_prefix ON articles(title(50));
-- ä¸¤ä¸ªç´¢å¼•åŠŸèƒ½é‡å¤ï¼Œåº”è¯¥é€‰æ‹©ä¸€ä¸ª

-- âœ… æ­£ç¡®ï¼šåˆç†çš„ç´¢å¼•è®¾è®¡
CREATE INDEX idx_users_status_created ON users(status, created_at);
-- è¿™ä¸ªç´¢å¼•å¯ä»¥æ”¯æŒä»¥ä¸‹æŸ¥è¯¢ï¼š
-- WHERE status = ?                    âœ“
-- WHERE status = ? AND created_at > ? âœ“
-- ORDER BY status, created_at         âœ“
```

#### ç´¢å¼•æ•°é‡æ§åˆ¶
```sql
-- æ¯å¼ è¡¨çš„ç´¢å¼•æ•°é‡å»ºè®®æ§åˆ¶åœ¨5ä¸ªä»¥å†…
-- æ ¸å¿ƒä¸šåŠ¡è¡¨å¯ä»¥é€‚å½“å¢åŠ ï¼Œä½†ä¹Ÿä¸åº”è¶…è¿‡10ä¸ª

-- usersè¡¨ç´¢å¼•è®¾è®¡ç¤ºä¾‹
CREATE UNIQUE INDEX uk_users_username ON users(username);           -- ä¸šåŠ¡å”¯ä¸€
CREATE UNIQUE INDEX uk_users_email ON users(email);                 -- ä¸šåŠ¡å”¯ä¸€
CREATE INDEX idx_users_status ON users(status);                     -- çŠ¶æ€æŸ¥è¯¢
CREATE INDEX idx_users_created_at ON users(created_at);             -- æ—¶é—´æŸ¥è¯¢
CREATE INDEX idx_users_last_login ON users(last_login_at DESC);    -- ç™»å½•æŸ¥è¯¢
-- æ€»è®¡5ä¸ªç´¢å¼•ï¼Œè¦†ç›–ä¸»è¦æŸ¥è¯¢åœºæ™¯
```

---

## âš¡ ç´¢å¼•æ€§èƒ½ä¼˜åŒ–

### 1. æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥

#### ç´¢å¼•è¦†ç›–æŸ¥è¯¢
```sql
-- è®¾è®¡è¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨æ“ä½œ
CREATE INDEX idx_articles_list ON articles(category_id, status, id, title, created_at);
-- æŸ¥è¯¢æ—¶å¯ä»¥ç›´æ¥ä»ç´¢å¼•è·å–æ‰€æœ‰éœ€è¦çš„æ•°æ®
SELECT id, title, created_at
FROM articles
WHERE category_id = ? AND status = 'PUBLISHED'
ORDER BY created_at DESC;

-- ç”¨æˆ·æŸ¥è¯¢çš„è¦†ç›–ç´¢å¼•
CREATE INDEX idx_users_profile ON users(id, username, avatar_url, status);
SELECT id, username, avatar_url, status
FROM users
WHERE id = ?;
```

#### æ’åºä¼˜åŒ–
```sql
-- åˆ©ç”¨ç´¢å¼•è¿›è¡Œæ’åºä¼˜åŒ–
CREATE INDEX idx_articles_category_publish ON articles(category_id, publish_date DESC);
-- æŸ¥è¯¢å¯ä»¥ç›´æ¥åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§
SELECT * FROM articles
WHERE category_id = ?
ORDER BY publish_date DESC;

-- å¤åˆæ’åºä¼˜åŒ–
CREATE INDEX idx_products_category_price_rating ON products(category_id, price DESC, rating DESC);
-- æ”¯æŒå¤šå­—æ®µæ’åº
SELECT * FROM products
WHERE category_id = ?
ORDER BY price DESC, rating DESC;
```

#### åˆ†é¡µä¼˜åŒ–
```sql
-- åˆ©ç”¨ç´¢å¼•ä¼˜åŒ–æ·±åˆ†é¡µ
CREATE INDEX idx_articles_created ON articles(created_at DESC, id);
-- ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µä»£æ›¿OFFSET
SELECT * FROM articles
WHERE created_at < ? OR (created_at = ? AND id < ?)
ORDER BY created_at DESC, id DESC
LIMIT 20;
```

### 2. å†™å…¥æ€§èƒ½ä¼˜åŒ–

#### æ‰¹é‡æ’å…¥ä¼˜åŒ–
```sql
-- ä¸´æ—¶ç¦ç”¨ç´¢å¼•ï¼Œæå‡æ‰¹é‡æ’å…¥æ€§èƒ½
ALTER TABLE users DISABLE KEYS;
-- æ‰§è¡Œæ‰¹é‡æ’å…¥
INSERT INTO users (...) VALUES (...), (...), (...);
-- é‡æ–°å¯ç”¨ç´¢å¼•
ALTER TABLE users ENABLE KEYS;

-- ä½¿ç”¨LOAD DATA INFILEæ‰¹é‡å¯¼å…¥
LOAD DATA INFILE '/path/to/users.csv'
INTO TABLE users
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';
```

#### ç´¢å¼•ç»´æŠ¤ç­–ç•¥
```sql
-- å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
ANALYZE TABLE users;
ANALYZE TABLE articles;
ANALYZE TABLE orders;

-- é‡å»ºç¢ç‰‡åŒ–çš„ç´¢å¼•
ALTER TABLE users ENGINE=InnoDB;
OPTIMIZE TABLE users;

-- åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•
-- éœ€è¦é€šè¿‡ç›‘æ§å·¥å…·åˆ†æåç¡®å®š
DROP INDEX idx_unused_index ON table_name;
```

### 3. å­˜å‚¨ç©ºé—´ä¼˜åŒ–

#### å‰ç¼€ç´¢å¼•ä¼˜åŒ–
```sql
-- åˆç†é€‰æ‹©å‰ç¼€é•¿åº¦
-- é€šè¿‡è®¡ç®—é€‰æ‹©æœ€ä¼˜å‰ç¼€é•¿åº¦
SELECT
    COUNT(DISTINCT LEFT(title, 10)) / COUNT(DISTINCT title) AS prefix_10_selectivity,
    COUNT(DISTINCT LEFT(title, 20)) / COUNT(DISTINCT title) AS prefix_20_selectivity,
    COUNT(DISTINCT LEFT(title, 50)) / COUNT(DISTINCT title) AS prefix_50_selectivity
FROM articles;

-- æ ¹æ®é€‰æ‹©æ€§åˆ›å»ºå‰ç¼€ç´¢å¼•
CREATE INDEX idx_articles_title_prefix ON articles(title(20));
```

#### ç´¢å¼•å‹ç¼©ï¼ˆMySQL 8.0+ï¼‰
```sql
-- ä½¿ç”¨å‹ç¼©ç´¢å¼•å‡å°‘å­˜å‚¨ç©ºé—´
CREATE INDEX idx_large_text_compressed ON large_table(large_text_column) USING BTREE;
-- MySQL 8.0+æ”¯æŒç´¢å¼•å‹ç¼©
ALTER TABLE large_table ALGORITHM=INPLACE, LOCK=NONE;
```

---

## ğŸ”§ ç´¢å¼•ç›‘æ§ä¸åˆ†æ

### 1. ç´¢å¼•ä½¿ç”¨æƒ…å†µç›‘æ§

#### æŸ¥è¯¢ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡
```sql
-- MySQL 8.0+ æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
    TABLE_SCHEMA,
    TABLE_NAME,
    INDEX_NAME,
    COUNT_FETCH,
    COUNT_INSERT,
    COUNT_UPDATE,
    COUNT_DELETE
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE INDEX_NAME IS NOT NULL
ORDER BY COUNT_FETCH DESC;

-- æŸ¥çœ‹æœªä½¿ç”¨çš„ç´¢å¼•
SELECT
    TABLE_SCHEMA,
    TABLE_NAME,
    INDEX_NAME,
    SEQ_IN_INDEX,
    COLUMN_NAME
FROM information_schema.STATISTICS s
LEFT JOIN performance_schema.table_io_waits_summary_by_index_usage i
    ON s.TABLE_SCHEMA = i.OBJECT_SCHEMA
    AND s.TABLE_NAME = i.OBJECT_NAME
    AND s.INDEX_NAME = i.INDEX_NAME
WHERE i.INDEX_NAME IS NULL
AND s.TABLE_SCHEMA NOT IN ('mysql', 'performance_schema', 'information_schema');
```

#### æ…¢æŸ¥è¯¢åˆ†æ
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2; -- 2ç§’ä»¥ä¸Šçš„æŸ¥è¯¢è®°å½•ä¸ºæ…¢æŸ¥è¯¢

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log
WHERE start_time > DATE_SUB(NOW(), INTERVAL 1 DAY)
ORDER BY query_time DESC;

-- åˆ†ææ…¢æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’
EXPLAIN FORMAT=JSON
SELECT * FROM articles
WHERE category_id = 1 AND status = 'PUBLISHED'
ORDER BY created_at DESC
LIMIT 20;
```

### 2. ç´¢å¼•æ€§èƒ½åˆ†æ

#### æ‰§è¡Œè®¡åˆ’åˆ†æ
```sql
-- æŸ¥çœ‹æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
EXPLAIN
SELECT * FROM users
WHERE status = 'ACTIVE' AND created_at > '2024-01-01'
ORDER BY last_login_at DESC;

-- åˆ†ææ‰§è¡Œç»“æœå…³æ³¨ç‚¹ï¼š
-- type: ALL (å…¨è¡¨æ‰«æ), index (ç´¢å¼•æ‰«æ), range (èŒƒå›´æ‰«æ), ref (ç´¢å¼•æŸ¥æ‰¾)
-- key: å®é™…ä½¿ç”¨çš„ç´¢å¼•
-- rows: é¢„ä¼°æ‰«æçš„è¡Œæ•°
-- Extra: Using index (ç´¢å¼•è¦†ç›–), Using filesort (éœ€è¦é¢å¤–æ’åº), Using temporary (ä½¿ç”¨ä¸´æ—¶è¡¨)
```

#### ç´¢å¼•é€‰æ‹©æ€§åˆ†æ
```sql
-- è®¡ç®—å­—æ®µçš„é€‰æ‹©æ€§ï¼ˆè¶Šæ¥è¿‘1è¶Šå¥½ï¼‰
SELECT
    COUNT(DISTINCT status) / COUNT(*) AS status_selectivity,
    COUNT(DISTINCT user_type) / COUNT(*) AS user_type_selectivity,
    COUNT(DISTINCT created_at) / COUNT(*) AS created_at_selectivity
FROM users;

-- åˆ†æå¤åˆç´¢å¼•çš„é€‰æ‹©æ€§
SELECT
    COUNT(DISTINCT status) / COUNT(*) AS status_selectivity,
    COUNT(DISTINCT CONCAT(status, '_', created_at)) / COUNT(*) AS composite_selectivity
FROM users;
```

### 3. ç´¢å¼•ä¼˜åŒ–å»ºè®®

#### åŸºäºç›‘æ§çš„ä¼˜åŒ–
```sql
-- å®šæœŸæ£€æŸ¥ç´¢å¼•ç¢ç‰‡
SELECT
    TABLE_NAME,
    INDEX_NAME,
    CARDINALITY,
    SUB_PART,
    NULLABLE,
    INDEX_TYPE
FROM information_schema.STATISTICS
WHERE TABLE_SCHEMA = DATABASE()
ORDER BY TABLE_NAME, SEQ_IN_INDEX;

-- æ£€æŸ¥è¡¨å¤§å°å’Œç´¢å¼•å¤§å°
SELECT
    TABLE_NAME,
    ROUND(((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024), 2) AS 'Table Size (MB)',
    ROUND((INDEX_LENGTH / 1024 / 1024), 2) AS 'Index Size (MB)',
    ROUND((INDEX_LENGTH / (DATA_LENGTH + INDEX_LENGTH)) * 100, 2) AS 'Index Ratio %'
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = DATABASE()
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC;
```

---

## ğŸ“‹ ç´¢å¼•è®¾è®¡æ£€æŸ¥æ¸…å•

### è®¾è®¡é˜¶æ®µæ£€æŸ¥
- [ ] **ä¸šåŠ¡éœ€æ±‚åˆ†æ**
  - [ ] è¯†åˆ«æ ¸å¿ƒæŸ¥è¯¢åœºæ™¯
  - [ ] åˆ†æé«˜é¢‘è®¿é—®è·¯å¾„
  - [ ] ç¡®å®šæ€§èƒ½å…³é”®è·¯å¾„

- [ ] **å­—æ®µé€‰æ‹©åˆç†æ€§**
  - [ ] ä¸»é”®å­—æ®µé€‰æ‹©åˆé€‚
  - [ ] å¤–é”®å­—æ®µå»ºç«‹ç´¢å¼•
  - [ ] å”¯ä¸€æ€§å­—æ®µå»ºç«‹å”¯ä¸€ç´¢å¼•
  - [ ] é«˜é¢‘æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•

- [ ] **ç´¢å¼•ç±»å‹é€‰æ‹©**
  - [ ] æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚ç´¢å¼•ç±»å‹
  - [ ] é¿å…ä¸å¿…è¦çš„å…¨æ–‡ç´¢å¼•
  - [ ] åˆç†ä½¿ç”¨å‰ç¼€ç´¢å¼•

### å®ç°é˜¶æ®µæ£€æŸ¥
- [ ] **ç´¢å¼•å‘½åè§„èŒƒ**
  - [ ] å”¯ä¸€ç´¢å¼•ä½¿ç”¨uk_å‰ç¼€
  - [ ] æ™®é€šç´¢å¼•ä½¿ç”¨idx_å‰ç¼€
  - [ ] ç´¢å¼•åç§°åŒ…å«è¡¨åå’Œå­—æ®µå

- [ ] **å¤åˆç´¢å¼•è®¾è®¡**
  - [ ] å­—æ®µé¡ºåºç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™
  - [ ] é«˜é€‰æ‹©æ€§å­—æ®µåœ¨å‰
  - [ ] è¦†ç›–ä¸»è¦æŸ¥è¯¢åœºæ™¯

- [ ] **é¿å…è¿‡åº¦ç´¢å¼•**
  - [ ] æ²¡æœ‰é‡å¤åŠŸèƒ½çš„ç´¢å¼•
  - [ ] ç´¢å¼•æ•°é‡æ§åˆ¶åœ¨åˆç†èŒƒå›´
  - [ ] å®šæœŸæ¸…ç†æœªä½¿ç”¨ç´¢å¼•

### ä¼˜åŒ–é˜¶æ®µæ£€æŸ¥
- [ ] **æ€§èƒ½ç›‘æ§**
  - [ ] å»ºç«‹ç´¢å¼•ä½¿ç”¨æƒ…å†µç›‘æ§
  - [ ] å®šæœŸåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
  - [ ] ç›‘æ§ç´¢å¼•ç¢ç‰‡æƒ…å†µ

- [ ] **æŒç»­ä¼˜åŒ–**
  - [ ] æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ç´¢å¼•
  - [ ] ä¼˜åŒ–å¤åˆç´¢å¼•å­—æ®µé¡ºåº
  - [ ] åŠæ—¶åˆ é™¤æ— ç”¨ç´¢å¼•

### ç»´æŠ¤é˜¶æ®µæ£€æŸ¥
- [ ] **æ–‡æ¡£ç»´æŠ¤**
  - [ ] ç´¢å¼•è®¾è®¡æ–‡æ¡£åŠæ—¶æ›´æ–°
  - [ ] è®°å½•ç´¢å¼•å˜æ›´åŸå› 
  - [ ] ç»´æŠ¤ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡

- [ ] **å®šæœŸè¯„ä¼°**
  - [ ] æ¯æœˆè¯„ä¼°ç´¢å¼•æ•ˆæœ
  - [ ] åˆ†æä¸šåŠ¡å˜åŒ–å¯¹ç´¢å¼•çš„å½±å“
  - [ ] åˆ¶å®šç´¢å¼•ä¼˜åŒ–è®¡åˆ’

---

## ğŸ› ï¸ ç´¢å¼•è®¾è®¡å·¥å…·ä¸æŠ€å·§

### 1. ç´¢å¼•åˆ†æå·¥å…·

#### MySQLå†…ç½®å·¥å…·
```sql
-- SHOW INDEX æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯
SHOW INDEX FROM users;

-- EXPLAIN åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM users WHERE status = 'ACTIVE';

-- PROCEDURE ANALYSE åˆ†æè¡¨ç»“æ„
SELECT * FROM users PROCEDURE ANALYSE();

-- INFORMATION_SCHEMA è·å–ç´¢å¼•ç»Ÿè®¡
SELECT * FROM information_schema.STATISTICS WHERE TABLE_NAME = 'users';
```

#### ç¬¬ä¸‰æ–¹å·¥å…·
- **pt-index-usage** (Percona Toolkit): åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
- **MySQL Enterprise Monitor**: å®˜æ–¹ç›‘æ§å·¥å…·
- **Prometheus + Grafana**: å¼€æºç›‘æ§æ–¹æ¡ˆ
- **JetBrains DataGrip**: IDEå†…ç½®çš„ç´¢å¼•åˆ†æå·¥å…·

### 2. ç´¢å¼•è®¾è®¡æŠ€å·§

#### åŸºäºæŸ¥è¯¢æ¨¡å¼è®¾è®¡
```sql
-- åˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œè®¾è®¡å¯¹åº”ç´¢å¼•
-- å¸¸è§æŸ¥è¯¢1: ç”¨æˆ·ç™»å½•
SELECT * FROM users WHERE username = ? AND password_hash = ?;
-- å¯¹åº”ç´¢å¼•: UNIQUE INDEX uk_users_username ON users(username);

-- å¸¸è§æŸ¥è¯¢2: è·å–ç”¨æˆ·æ–‡ç« åˆ—è¡¨
SELECT * FROM articles WHERE user_id = ? AND status = 'PUBLISHED' ORDER BY created_at DESC;
-- å¯¹åº”ç´¢å¼•: INDEX idx_articles_user_status_created ON articles(user_id, status, created_at DESC);

-- å¸¸è§æŸ¥è¯¢3: æœç´¢æ–‡ç« 
SELECT * FROM articles WHERE title LIKE ? AND status = 'PUBLISHED';
-- å¯¹åº”ç´¢å¼•: INDEX idx_articles_title_status ON articles(title, status);
```

#### åŸºäºæ•°æ®ç‰¹å¾è®¾è®¡
```sql
-- æ ¹æ®æ•°æ®åˆ†å¸ƒç‰¹å¾è®¾è®¡ç´¢å¼•
-- é«˜åŸºæ•°å­—æ®µé€‚åˆæ”¾åœ¨å¤åˆç´¢å¼•å‰é¢
SELECT
    COUNT(DISTINCT status) AS status_count,
    COUNT(DISTINCT user_id) AS user_id_count,
    COUNT(DISTINCT created_at) AS created_at_count
FROM articles;

-- æ ¹æ®é€‰æ‹©æ€§è°ƒæ•´ç´¢å¼•é¡ºåº
-- å¦‚æœuser_idé€‰æ‹©æ€§æ›´é«˜ï¼Œåº”è¯¥æ”¾åœ¨å‰é¢
CREATE INDEX idx_articles_user_status ON articles(user_id, status);
```

---

**æ–‡æ¡£ç»´æŠ¤**ï¼šç´¢å¼•è®¾è®¡æŒ‡å¯¼æ–‡æ¡£éšæ•°æ®åº“è®¾è®¡å’Œä¸šåŠ¡å‘å±•æŒç»­æ›´æ–°
**æœ€åæ›´æ–°**ï¼š2025-10-30
**ç»´æŠ¤äººå‘˜**ï¼šç›¸ç¬‘ä¸æ˜¥é£