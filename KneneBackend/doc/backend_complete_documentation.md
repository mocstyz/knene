# 影视资源下载网站后端完整文档

## 项目概述

本项目是一个综合性的影视资源下载网站，提供电影、电视剧、电子书、图片等多类型资源。网站采用VIP会员制度进行商业变现，同时确保普通用户也能获得基本的资源访问权限。

## 1. 系统架构

### 1.1 架构概述

本项目采用微服务架构，基于Spring Cloud生态系统构建。系统被划分为多个独立的服务，每个服务负责特定的业务功能。这种架构使得系统具有高可扩展性、高可用性和良好的容错能力。

### 1.2 技术栈

**后端核心框架**：
- **核心框架**：Spring Boot 3.5.7
- **微服务框架**：Spring Cloud Alibaba
- **服务发现与配置中心**：Nacos（推荐，阿里巴巴开源）
- **网关**：Nginx
- **服务调用**：Spring Cloud OpenFeign
- **负载均衡**：Spring Cloud LoadBalancer
- **熔断降级**：Sentinel
- **消息队列**：RocketMQ（阿里巴巴开源）
- **数据库**：MySQL 8.0
- **缓存**：Redis
- **搜索引擎**：Elasticsearch
- **文档存储**：MinIO（对象存储）
- **ORM框架**：MyBatis-Plus

**前端技术栈**：
- Next.js + React：提供SSR支持与良好的SEO表现
- Redux Toolkit：状态管理
- Tailwind CSS：快速构建UI
- HeroUI组件库：提供美观的基础组件

**爬虫服务**：
-  Crawl4AI 配合 Playwright + GLM-4.5V 配置和开发


**部署与运维**：
- **监控**：Spring Boot Admin, Prometheus + Grafana
- **日志收集**：ELK Stack（Elasticsearch, Logstash, Kibana）
- **CI/CD**：Jenkins
- **容器化**：Docker, Kubernetes
- **反向代理**：Nginx

### 1.3 系统拓扑图

```
                                     +---------------------------+
                                     |   Nginx / Load Balancer   |
                                     +-------------+-------------+
                                                   |
                              +--------------------v--------------------+
                              |        Spring Cloud Gateway             |
                              +-------------+---------------+-----------+
                                            |               |
                                 +----------v--+       +----v----+
                                 |  Sentinel   |       |  Nacos  |
                                 | (限流/熔断) |       |(注册/配置)|
                                 +-------------+       +---------+

   +---------------------+----------------+----------------+----------------+----------------+
   |                     |                |                |                |                |
+--v--+              +---v---+        +---v---+        +---v---+        +---v---+        +---v---+
|Auth |              | User  |        |Resource|        |Download|        | Admin |        |Search |
|Svc  |              | Svc   |        |  Svc   |        |  Svc   |        |  Svc  |        |  Svc |
+--+--+              +---+---+        +---+---+        +---+---+        +---+---+        +---+---+
   |                      |                |                |                |                |
   |                  +---v---+        +---v---+        +---v---+        +---v---+        +---v---+
   |                  |USER_DB|        |RES_DB |        |DL_DB  |        |ADMIN_DB|       |Elastic|
   |                  +-------+        |(普通/VIP)       +-------+        +--------+       |Search |
   |                                    +-------+                                      +---+-------+
   |                      +----------------+----------------+----------------+---------|-----------+
   |                                       |                Shared Redis Cluster      |
   |                                       +------------------------------------------+
   |                                                         |
   |                                      +------------------v------------------+
   |                                      |              MinIO                 |
   |                                      +------------------------------------+

   +----------------------------------------------------------------------------------------------+
                                     RocketMQ 消息总线
   Topics: user.notification | resource.update | download.completed | crawler.task | system.log
                  ^                   ^                    ^                 ^               ^
                  |                   |                    |                 |               |
          Notification Svc     Resource Svc         Download Svc       Crawler Svc       Admin Svc
```


#### 拓扑图说明（要点）

- 流量入口：用户请求经过`Nginx / Load Balancer`进入`Spring Cloud Gateway`，网关统一鉴权、限流、路由。
- 治理组件：`Sentinel`在网关和服务侧执行限流/熔断；`Nacos`提供服务注册与集中配置。
- 同步调用：`Gateway`将请求按路由转发到`Auth`、`User`、`Resource`、`Download`、`Admin`、`Search`等服务；服务间通过`OpenFeign`调用并使用`LoadBalancer`。
- 数据存储：各服务使用独立`MySQL`库；`Resource DB`按`普通/VIP`分库；文件与种子归档在`MinIO`。
- 缓存与状态：跨服务共享`Redis`，用于会话、计数器、热点数据、令牌桶限流等。
- 搜索链路：`Search Service`维护`Elasticsearch`索引并提供搜索；`Resource Service`变更通过消息触发索引更新。
- 事件总线：`RocketMQ`承载业务事件（`user.notification`、`resource.update`、`download.completed`、`crawler.task`、`system.log`）；相关服务作为生产者/消费者，保证幂等与重试。
- 通知通道：`Notification Service`消费消息，向用户推送站内信、邮件和`WebSocket`实时消息。
- 爬虫闭环：`Crawler Service`消费`crawler.task`，采集/上传资源，触发`resource.update`，完成自动化闭环。
- 安全与观测：`JWT`在网关/服务侧统一校验；监控与日志（`Prometheus/Grafana`、`ELK`、`Spring Boot Admin`）横向覆盖（可选展示）。

## 2. 服务模块设计

### 2.1 网关服务 (Gateway Service)

网关服务是系统的入口点，负责请求路由、负载均衡、认证授权、限流等功能。

**核心功能**：
- 路由转发
- 请求过滤
- 限流控制
- API文档聚合
- 日志记录
- 请求响应转换

**技术实现**：
- Spring Cloud Gateway
- Redis (限流)
- JWT (令牌验证)

### 2.2 认证授权服务 (Auth Service)

负责用户认证和授权管理，包括用户登录、注册、权限控制等。

**核心功能**：
- 用户登录认证
- 令牌颁发与验证
- 用户权限管理
- 密码重置
- 第三方登录集成

**技术实现**：
- Spring Security
- JWT
- OAuth2
- Redis (令牌存储)

### 2.3 用户服务 (User Service)

管理用户信息、会员等级、用户偏好等用户相关功能。

**核心功能**：
- 用户信息管理
- 会员等级管理
- 用户收藏与历史
- 用户反馈与求片
- 用户设置管理

**技术实现**：
- Spring Boot
- MySQL
- Redis (缓存)
- RocketMQ (消息通知)

### 2.4 资源服务 (Resource Service)

管理影视资源的信息、分类、标签等元数据。

**核心功能**：
- 资源元数据管理
- 分类与标签管理
- 资源检索与筛选
- 资源评分与评论
- 资源推荐算法

**技术实现**：
- Spring Boot
- MySQL
- Elasticsearch (搜索)
- Redis (缓存)

### 2.5 下载服务 (Download Service)

负责资源下载链接管理、下载限制控制、下载统计等。

**核心功能**：
- 下载链接管理
- 下载限制控制
- 下载统计与分析
- 资源健康检查
- 热门资源分析

**技术实现**：
- Spring Boot
- MySQL
- Redis (下载统计与限制)
- MinIO (资源存储)

### 2.6 搜索服务 (Search Service)

提供全文搜索和高级检索功能。

**核心功能**：
- 全文检索
- 高级筛选
- 搜索建议
- 热门搜索
- 搜索结果缓存

**技术实现**：
- Elasticsearch
- Redis (缓存)
- Spring Data Elasticsearch

### 2.7 通知服务 (Notification Service)

管理系统通知、邮件发送、用户消息等。

**核心功能**：
- 系统公告
- 邮件通知
- 用户消息
- 站内信
- 推送服务集成

**技术实现**：
- Spring Boot
- RocketMQ
- Redis
- WebSocket (实时通知)

### 2.8 管理后台服务 (Admin Service)

提供管理员界面的后端支持，用于系统管理和运营。

**核心功能**：
- 用户管理
- 资源管理
- 系统配置
- 数据统计
- 操作日志

**技术实现**：
- Spring Boot
- MySQL
- Redis

### 2.9 爬虫服务 (Crawler Service)

自动采集和更新资源信息。

**核心功能**：
- 资源信息采集
- 资源链接更新
- 定时任务调度
- 代理IP池管理
- 爬虫规则配置

**技术实现**：
- Spring Boot
- WebMagic/Jsoup
- Redis (代理池、任务队列)
- MySQL (数据存储)

## 3. 业务需求详细设计

### 3.1 用户系统

#### 用户分层

**管理层**：
- **超级管理员**：拥有系统全部权限
- **普通管理员**：拥有部分管理权限
- **权限动态管理**：后台管理系统支持实时增减权限

**普通用户**：
- **VIP用户**：可下载全部资源，包括VIP专属资源，设有每日下载次数限制
- **普通用户**：仅可下载普通资源，对VIP资源只能查看不能下载

#### 管理员功能

**超级管理员**：
- 用户管理（增删改查）
- IP封禁管理
- 系统全部功能控制权
- 权限分配

**普通管理员**：
- 资源管理
- 有限的用户管理权限
- 权限由超级管理员分配

#### 用户个人中心

**个人资料管理**：
- 基本信息编辑
- 头像设置（仅支持图床链接，不支持服务器上传）

**下载管理**：
- 下载历史记录
- 资源下载总量统计（GB/TB自动转换）

**内容互动**：
- 收藏列表
- 评论列表（资源评论及用户评论回复）

#### 消息中心

- **系统通知**：平台公告、系统更新等信息
- **管理员消息**：管理员可向特定用户发送实时消息
- **用户反馈**：用户可向管理员发送消息，实现用户与管理员的双向通信
- **工单系统**：用户可提交问题工单，管理员处理后反馈结果
- **消息状态追踪**：仅管理员可查看消息已读/未读状态及历史消息，用户端不支持此功能
- **不支持**用户间私信功能

### 3.2 资源系统

#### 普通资源获取

- **资源来源**：[TorrentGalaxy](https://torrentgalaxy.to/torrents.php)（后续可能更换为其它网站）
- **筛选标准**：仅爬取带IMDB信息的影片和电子书资源
- **访问权限**：普通用户和VIP用户均可下载
- **处理策略**：
  - 只保存资源元数据和种子文件
  - 混合图片存储方案：
    - 封面图片(poster)上传至图床，确保资源列表页面稳定一致的展示效果
    - 其他图片(screenshots)直接引用原站URL，不上传图床
  - 图片风险管理：
    - 实现原站图片的本地缓存机制，当原链接失效时自动切换使用
    - 缓存策略基于访问频率和重要性动态调整
  - 轻量化存储，减少服务器负担
  - 定期检查原站图片链接有效性

#### VIP专属资源

- **资源来源**：[SpringSunday PT站](https://springsunday.net/torrents.php)
- **处理流程**：
  - 爬取资源信息和相关图片
  - 将资源图片上传到图床，确保长期稳定访问
  - 下载资源到服务器
  - 上传资源到115网盘并生成分享链接
  - 本地服务器制作qBittorrent种子文件
  - 种子上传到网站做种2天
  - 2天后删除本地资源文件，仅保留115网盘分享链接和图床图片
- **访问权限**：仅VIP用户可下载，每日下载次数有限
- **普通用户**：仅能浏览资源信息，无法下载

#### 求片系统

**用户求片流程**：
- 用户提交求片请求（电影/剧集名称、年份、IMDB/豆瓣ID等信息）
- 系统自动检索现有资源库，验证是否已存在相同资源
- 若已存在，直接向用户展示现有资源链接
- 若不存在，求片请求发布成功并进入处理队列

**重复验证机制**：
- 基于影片元数据（IMDB ID、豆瓣ID、名称+年份等）进行智能匹配
- 支持模糊匹配，处理不同版本、不同清晰度的同一资源
- 展示相似度较高的资源作为备选推荐

**自动处理系统**：
- 系统定期扫描求片队列，按优先级排序（VIP用户请求优先）
- 自动连接到PT站（SpringSunday）进行资源搜索
- 找到匹配资源后自动触发爬取、下载、上传、制种等完整流程
- 全流程无需人工干预，减轻管理员工作量

**状态追踪与通知**：
- 用户可查看求片请求的处理状态（等待处理、搜索中、已找到、处理中、已完成）
- 资源添加完成后自动通知请求用户
- 系统记录求片请求统计数据，优化后续处理策略

**管理员审核**：
- 特殊资源或自动处理失败的请求转入管理员手动处理队列
- 管理员可对求片请求进行优先级调整
- 管理员可手动添加找到的资源

#### 影片信息本地化

- 爬取豆瓣影片中文信息
- 与国外资源信息整合存储

#### 资源失效自动处理系统

**举报机制**：
- 用户可在资源页面点击"举报失效"按钮
- 系统记录举报信息及举报用户

**自动处理流程**：
- 系统检测到失效举报后自动触发处理
- 从原始PT站(SpringSunday)重新爬取该资源
- 下载资源到服务器
- 重新上传到115网盘并生成新的分享链接
- 本地服务器制作新的qBittorrent种子文件
- 在服务器自动做种2天
- 更新数据库中的资源链接信息

**用户通知**：
- 资源恢复后自动向举报用户发送通知
- 通知包含新的可用链接
- 用户可直接通过通知跳转至更新后的资源页面

**资源监控**：
- 对频繁失效的资源进行标记
- 定期自动检查热门资源有效性
- 建立资源健康度评分系统

### 3.3 内容管理系统

#### 新闻模块

**功能定位**：
- 发布行业动态、站点更新、影视资讯等内容
- 提高用户粘性与搜索引擎收录
- 作为平台重要的内容营销渠道

**内容管理**：
- 管理员发布、编辑、删除文章
- 文章分类与标签管理
- 文章排序与推荐设置
- 定时发布功能

**前端展示**：
- 新闻首页（最新文章、热门文章）
- 文章详情页
- 相关文章推荐
- 分类浏览页面

**用户互动**：
- 文章评论功能
- 文章分享功能
- 收藏与点赞功能

#### WIKI知识库

**功能定位**：
- 提供影视相关专业知识
- 建立资源获取与使用指南
- 构建社区共建的知识体系

**内容组织**：
- 分类目录结构
- 关键词索引
- 版本历史记录
- 内部链接系统

**编辑权限**：
- 管理员完全编辑权限
- 资深VIP用户可提交修改建议
- 内容审核机制

**知识点类型**：
- 影视术语解释
- 软件使用教程
- 资源获取指南
- 常见问题解答（FAQ）
- 编解码知识

**特殊功能**：
- 搜索功能
- 贡献者积分机制
- 内容纠错反馈
- 打印友好版本

### 3.4 图床服务

**差异化图片处理策略**：
- **VIP资源图片**：上传到图床存储，确保长期稳定访问
- **普通资源图片**：采用混合存储策略
  - 封面图片(poster)上传至图床
  - 截图等次要图片引用原站URL

**图床功能**：
- 为VIP资源提供稳定可靠的图片存储服务
- 为普通资源的封面图片提供存储服务
- 支持图片压缩和优化，提高加载速度
- 定期检测图片有效性，确保内容展示质量

**图片缓存与备份机制**：
- 对普通资源的原站图片实现智能缓存
- 首次访问时自动缓存到本地临时存储
- 设置基于流行度的缓存优先级和过期策略
- 原站链接失效时自动切换到缓存版本

**技术实现**：
- VIP资源图片：爬取后上传至图床，存储图床URL
- 普通资源封面图片：爬取后上传至图床，确保列表页展示质量
- 普通资源其他图片：仅记录原始URL，并实现本地缓存
- 前端实现图片懒加载，优化页面加载速度
- 图片加载失败时显示默认占位图

### 3.5 VIP系统

#### 充值系统

- 多种支付方式集成
- 定期促销与优惠活动
- 充值记录与消费明细

#### VIP特权设计

- 专属标识：VIP用户徽章、头像框
- 界面专属样式与特效
- 下载速度提升
- 专属客服服务
- 资源请求优先处理

### 3.6 广告系统

#### 广告位规划

**首页广告位**：
- 顶部横幅（轮播）
- 资源列表间插广告
- 侧边栏推广位

**资源详情页广告位**：
- 下载按钮周边广告
- 相关推荐区域广告位
- 底部横幅广告

**搜索结果页广告位**：
- 搜索结果顶部推广位
- 搜索结果间插广告
- 相关搜索推广

#### 广告系统设计

**广告投放策略**：
- 基于用户兴趣的精准投放
- 基于资源内容的上下文广告
- 不同用户等级显示不同广告（VIP用户可减少广告干扰）

**广告管理功能**：
- 广告位管理（开启/关闭）
- 广告素材管理
- 广告效果统计与分析
- A/B测试支持

**广告联盟对接**：
- 预留第三方广告联盟接口
- 支持多家广告联盟同时接入
- 广告收益智能优化系统

#### 广告用户体验

**非侵入式设计**：
- 避免弹窗和全屏广告
- 确保广告不影响核心功能使用
- 明确标识广告内容

**广告加载优化**：
- 异步加载确保不阻塞页面渲染
- 预留广告位尺寸减少布局偏移
- 广告失效时自动调整布局

## 4. 数据库设计

### 4.1 数据库架构

系统采用按服务垂直拆分的数据库架构，每个服务维护自己的数据库，同时使用Flyway进行数据库版本控制。

```
+-------------------+    +-------------------+    +-------------------+
|    USER_DB        |    |    RESOURCE_DB    |    |    DOWNLOAD_DB    |
+-------------------+    +-------------------+    +-------------------+
| - user            |    | - resource        |    | - download_record |
| - user_profile    |    | - category        |    | - download_link   |
| - user_preference |    | - tag             |    | - resource_file   |
| - user_level      |    | - resource_tag    |    | - validation_log  |
| - feedback        |    | - comment         |    | - traffic_stat    |
| - favorite        |    | - rating          |    +-------------------+
| - history         |    | - resource_detail |
+-------------------+    +-------------------+
```

### 4.2 分库存储策略

- 考虑将普通资源和VIP资源分为两个独立数据库
- 普通资源库：轻量级存储，主要包含元数据和外部链接
- VIP资源库：完整存储，包含详细元数据、本地种子文件和115网盘链接

**分库优势**：
- 提高查询效率：针对不同用户类型优化查询性能
- 差异化备份策略：VIP资源更高频率备份
- 灵活的扩容管理：根据不同资源库增长速度单独扩容
- 安全隔离：降低全库数据泄露风险

**实现方案**：
- 采用分片集群实现物理隔离
- 构建统一资源检索层，屏蔽底层分库细节
- 资源ID采用统一编码规则，保持全局唯一性

### 4.3 数据库优化策略

- **分库分表**：使用Sharding-JDBC实现读写分离和分库分表
- **索引优化**：合理设计索引，定期维护
- **查询优化**：使用SQL审计，优化慢查询
- **缓存策略**：多级缓存，减轻数据库压力
- **定期维护**：按计划进行数据库优化和维护

## 5. 缓存设计

### 5.1 缓存层次

1. **本地缓存（一级缓存）**
   - Caffeine缓存
   - 适用于高频访问且变化不频繁的数据
   - 例如：系统配置、字典数据等

2. **分布式缓存（二级缓存）**
   - Redis缓存
   - 适用于共享数据和需要跨服务访问的数据
   - 例如：用户会话、热门资源、计数器等

3. **搜索引擎（三级缓存）**
   - Elasticsearch
   - 适用于全文搜索和复杂查询
   - 例如：资源检索、智能推荐等

### 5.2 缓存同步策略

- **被动失效**：数据更新时主动使相关缓存失效
- **定时刷新**：对于热点数据定时刷新缓存
- **按需加载**：首次访问时加载缓存（Cache-Aside模式）
- **写入同步**：关键数据更新时同步更新缓存（Write-Through模式）

### 5.3 TMDb API缓存策略

本项目将使用TMDb (The Movie Database) API作为影视元数据的主要来源。考虑到TMDb API的使用限制(每日约3000-4000次请求)，我们需要实施有效的缓存策略。

#### 缓存层设计

```
# TMDb电影详情缓存
Key: movie:tmdb:movie:{tmdb_id}
Type: Hash
Fields: 电影各字段(title, overview, release_date等)
TTL: 7天

# TMDb电视剧详情缓存
Key: movie:tmdb:tv:{tmdb_id}
Type: Hash
Fields: 电视剧各字段
TTL: 7天

# TMDb演员信息缓存
Key: movie:tmdb:person:{person_id}
Type: Hash
Fields: 演员信息字段
TTL: 30天

# TMDb搜索结果缓存
Key: movie:tmdb:search:{query_hash}
Type: String (序列化的JSON)
Value: 搜索结果
TTL: 24小时

# TMDb热门/流行内容缓存
Key: movie:tmdb:trending:{media_type}:{time_window}
Type: String (序列化的JSON)
Value: 热门内容列表
TTL: 6小时

# TMDb图片URL缓存
Key: movie:tmdb:images:{reference_type}:{reference_id}
Type: List
Members: 图片URL列表
TTL: 15天
```

#### 缓存优化策略

1. **分层缓存**:
   - 热门影视数据使用更长的缓存时间
   - 搜索结果较短缓存时间
   - 基础元数据较长缓存时间
   - 图片URL极长缓存时间

2. **预加载机制**:
   - 定时任务预加载热门影视数据
   - 新资源上线时预加载相关元数据
   - 首页内容预缓存

3. **缓存防击穿措施**:
   - 使用分布式锁防止缓存击穿
   - 热门数据缓存永不过期+后台异步更新策略
   - 请求合并处理

4. **缓存一致性**:
   - 电影信息更新时主动使相关缓存失效
   - 使用版本号管理缓存数据

## 6. 消息队列设计

系统使用RocketMQ作为消息队列中间件，实现服务间的异步通信和事件驱动架构。RocketMQ是阿里巴巴开源的高性能消息队列，在大规模、高并发场景下具有出色的性能表现。

### 6.1 主要消息队列

| 队列名称 | 用途 | 消息格式 |
|---------|------|---------|
| user.notification | 用户通知 | {userId, type, content, timestamp} |
| resource.update | 资源更新 | {resourceId, updateType, data, timestamp} |
| download.completed | 下载完成 | {userId, resourceId, size, timestamp} |
| crawler.task | 爬虫任务 | {targetUrl, priority, params, timestamp} |
| system.log | 系统日志 | {service, level, message, timestamp} |

### 6.2 消息处理策略

- **消息持久化**：确保消息不丢失
- **消息幂等性**：处理重复消息
- **死信队列**：处理失败消息
- **延迟队列**：处理需要延迟执行的任务
- **消息优先级**：处理紧急消息

## 7. 安全设计

### 7.1 认证与授权

- **JWT认证**：基于令牌的认证机制
- **OAuth2集成**：支持第三方登录
- **RBAC权限模型**：基于角色的访问控制
- **接口权限控制**：API级别的权限管理
- **数据权限控制**：行级别的数据访问控制

### 7.2 数据安全

- **数据加密**：敏感数据存储和传输加密
- **参数验证**：防止注入攻击
- **XSS防护**：过滤用户输入
- **CSRF防护**：跨站请求伪造防护
- **数据脱敏**：敏感信息展示脱敏

### 7.3 网络安全

- **HTTPS**：全站HTTPS加密
- **WAF防护**：Web应用防火墙
- **限流控制**：防止DDoS攻击
- **IP黑名单**：封禁恶意IP
- **漏洞扫描**：定期安全扫描

## 8. 高可用设计

### 8.1 服务高可用

- **服务集群**：关键服务多实例部署
- **自动扩缩容**：根据负载自动调整实例数
- **健康检查**：服务健康状态监控
- **熔断降级**：服务故障时自动降级
- **限流保护**：过载时保护系统

### 8.2 数据高可用

- **数据库主从复制**：实现数据备份和读写分离
- **数据库集群**：高可用数据库集群
- **缓存集群**：Redis集群部署
- **定期备份**：数据定期备份
- **灾难恢复**：灾难恢复预案

### 8.3 基础设施高可用

- **多可用区部署**：跨可用区部署
- **容器编排**：Kubernetes自动调度
- **负载均衡**：流量均衡分发
- **CDN加速**：静态资源CDN分发
- **多云部署**：关键系统多云部署

## 9. 性能优化

### 9.1 应用层优化

- **异步处理**：非关键路径异步化
- **并行处理**：批量任务并行处理
- **线程池优化**：合理配置线程池
- **JVM调优**：JVM参数优化
- **代码优化**：关键代码性能优化

### 9.2 数据层优化

- **索引优化**：合理设计和使用索引
- **查询优化**：优化SQL查询
- **连接池优化**：数据库连接池优化
- **读写分离**：实现读写分离
- **分库分表**：高并发表分片

### 9.3 网络层优化

- **接口压缩**：HTTP响应压缩
- **资源合并**：减少HTTP请求
- **CDN加速**：静态资源CDN分发
- **HTTP/2**：使用HTTP/2协议
- **API网关优化**：网关性能优化

## 10. 项目结构与开发规范

### 10.1 目录结构

```
KneneBackend
├── .gitattributes
├── .gitignore
├── .mvn/
│   └── wrapper/
│       └── maven-wrapper.properties
├── docs/
│   ├── config_guide.md
│   ├── redis_design.md
│   └── backend_complete_documentation.md
├── logs/
│   └── application-dev.log
├── lombok.config
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/
│   │   │       └── knene/
│   │   │           └── movie/
│   │   │               ├── MovieBackendApplication.java
│   │   │               ├── application/
│   │   │               │   ├── auth/
│   │   │               │   │   ├── AuthService.java
│   │   │               │   │   ├── dto/
│   │   │               │   │   └── service/
│   │   │               │   ├── event/
│   │   │               │   └── user/
│   │   │               │       ├── UserApplicationService.java
│   │   │               │       ├── command/
│   │   │               │       └── dto/
│   │   │               ├── domain/
│   │   │               │   ├── common/
│   │   │               │   ├── model/
│   │   │               │   │   └── base/
│   │   │               │   ├── user/
│   │   │               │   │   ├── common/
│   │   │               │   │   ├── entity/
│   │   │               │   │   ├── enums/
│   │   │               │   │   ├── event/
│   │   │               │   │   ├── repository/
│   │   │               │   │   └── service/
│   │   │               │   │       └── impl/
│   │   │               │   └── verification/
│   │   │               │       ├── entity/
│   │   │               │       ├── repository/
│   │   │               │       └── service/
│   │   │               │           └── impl/
│   │   │               ├── infrastructure/
│   │   │               │   ├── captcha/
│   │   │               │   │   ├── TurnstileService.java
│   │   │               │   │   └── impl/
│   │   │               │   ├── common/
│   │   │               │   │   ├── aop/
│   │   │               │   │   ├── exception/
│   │   │               │   │   └── utils/
│   │   │               │   ├── config/
│   │   │               │   │   ├── properties/
│   │   │               │   ├── email/
│   │   │               │   │   ├── EmailService.java
│   │   │               │   │   └── impl/
│   │   │               │   ├── persistence/
│   │   │               │   │   ├── base/
│   │   │               │   │   ├── repository/
│   │   │               │   │   │   └── impl/
│   │   │               │   │   ├── user/
│   │   │               │   │   │   ├── entity/
│   │   │               │   │   │   ├── mapper/
│   │   │               │   │   │   └── repository/
│   │   │               │   │   │       └── impl/
│   │   │               │   │   └── verification/
│   │   │               │   │       ├── entity/
│   │   │               │   │       ├── mapper/
│   │   │               │   │       └── repository/
│   │   │               │   │           └── impl/
│   │   │               │   ├── security/
│   │   │               │   │   ├── annotation/
│   │   │               │   │   ├── aspect/
│   │   │               │   │   ├── filter/
│   │   │               │   │   └── service/
│   │   │               │   └── task/
│   │   │               └── interfaces/
│   │   │                   ├── api/
│   │   │                   │   ├── auth/
│   │   │                   │   └── user/
│   │   │                   ├── assembler/
│   │   │                   ├── dto/
│   │   │                   │   ├── request/
│   │   │                   │   └── response/
│   │   │                   └── response/
│   │   └── resources/
│   │       ├── application-dev.yml
│   │       ├── application-prod.yml
│   │       ├── application.yml
│   │       ├── db/
│   │       │   └── migration/
│   │       ├── docs/
│   │       └── mapper/
│   │           └── user/
│   └── test/
│       └── java/
│           └── com/
│               └── knene/
```

### 10.2 代码与架构核心原则

- **领域驱动设计（DDD）**：以业务领域为核心组织代码，强调领域模型的表达。
- **六边形架构（Ports & Adapters）**：业务核心与外部依赖解耦，便于扩展和测试。
- **SOLID 原则**：
  - 单一职责（SRP）：每个类/模块只负责一项功能。
  - 开闭原则（OCP）：对扩展开放，对修改关闭。
  - 依赖倒置（DIP）：依赖于抽象而非具体实现。
  - 接口隔离（ISP）：接口精细、职责单一。
  - 里氏替换（LSP）：子类可替换父类。
- **DRY 原则**：避免重复代码，通用逻辑抽取到基类或工具类。
- **模板方法模式**：通用流程在基类实现，特殊逻辑由子类扩展。
- **依赖注入**：优先构造器注入，提升可测试性和灵活性。
- **高内聚低耦合**：模块内部紧密协作，模块间松耦合。
- **javadoc 注释**：所有类需有标准 javadoc 注释，便于维护和协作。

### 10.3 开发与管理规范

#### 代码修改规范
1. **变更说明**：所有新增、修改、删除操作前，需说明原因。若为 BUG 修复，需明确指出问题性质、原因及位置。
2. **模块化组织**：新增文件/目录应按功能模块化，保持高内聚低耦合。
3. **同步一致性**：涉及 src 组件/逻辑变更需保持同步。
4. **废弃清理**：替换新方案后，必须删除废弃代码。
5. **错误检查**：每次修改后，立即处理编译器和开发工具报错。
6. **零错误提交**：禁止提交包含编译错误的代码。

#### 项目管理规范
1. **核心原则**：始终遵循 SOLID 原则，保持高内聚低耦合。
2. **项目认知**：项目开始前，务必阅读并理解 README.md，明确目标、架构、技术栈和开发计划。
3. **文档维护**：如无 README.md，需主动创建。每次目录/文件变更后，及时更新文档，保持一致。
4. **迭代记录**：每次代码变更后，需在 iterativeoptimal.md 记录修改内容，按 Markdown 顺序标记进度，已完成项注明"已完成"。

#### 代码规范
- **命名规范**：驼峰命名法
- **注释规范**：JavaDoc注释
- **异常处理**：统一异常处理
- **日志规范**：结构化日志
- **单元测试**：测试覆盖率要求

#### 接口规范
- **RESTful API**：遵循REST规范
- **版本控制**：API版本控制
- **参数校验**：统一参数校验
- **响应格式**：统一响应格式
- **API文档**：Swagger/OpenAPI文档

#### 数据库规范
- **命名规范**：表名、字段名规范
- **索引规范**：索引命名和使用规范
- **SQL规范**：SQL编写规范
- **事务规范**：事务使用规范
- **版本控制**：Flyway版本控制

## 11. 监控与运维

### 11.1 监控体系

- **应用监控**：Spring Boot Admin, Actuator
- **服务监控**：Prometheus, Grafana
- **日志监控**：ELK Stack
- **系统监控**：Node Exporter
- **告警机制**：邮件, SMS, 企业微信/钉钉

### 11.2 日志体系

- **日志收集**：Logstash/Filebeat
- **日志存储**：Elasticsearch
- **日志展示**：Kibana
- **日志分析**：定期日志分析报告
- **审计日志**：关键操作审计

### 11.3 部署策略

- **CI/CD流水线**：Jenkins/GitLab CI
- **蓝绿部署**：无缝切换
- **金丝雀发布**：灰度发布
- **回滚机制**：快速回滚
- **自动化测试**：部署前自动测试

## 12. 扩展性设计

### 12.1 技术扩展性

- **模块化设计**：功能模块化
- **插件化架构**：支持插件扩展
- **配置中心**：动态配置调整
- **服务注册发现**：动态服务注册
- **API版本控制**：支持多版本API

### 12.2 业务扩展性

- **业务事件驱动**：基于事件的扩展点
- **多租户支持**：支持业务隔离
- **国际化支持**：多语言支持
- **主题定制**：UI主题定制
- **业务配置化**：业务规则配置化

## 13. 开发规划

### 13.1 第一阶段：核心功能

- 用户系统基础实现
- 资源展示与管理
- 基础搜索功能
- VIP系统基础框架

### 13.2 第二阶段：爬虫与资源

- TorrentGalaxy爬虫
- SpringSunday爬虫
- 115网盘集成
- 资源处理流程自动化
- 资源失效自动处理系统

### 13.3 第三阶段：增强功能

- 消息中心
- 求片系统
- 智能求片处理系统
- 用户互动（评论、收藏）
- 高级搜索功能

### 13.4 第四阶段：优化与安全

- 性能优化
- 安全加固
- 用户体验改进
- 监控与日志系统

## 14. 商业模式与运营

### 14.1 盈利模式

- VIP会员订阅：月度/季度/年度计划
- 特定资源单次付费下载
- 定向广告投放（非侵入式）

### 14.2 用户增长

- SEO优化提高搜索引擎排名
- 内容质量保证与持续更新
- 用户推荐奖励计划
- 社交媒体引流

### 14.3 风险控制

- 版权风险规避策略
- 用户行为监控预警
- 资源合规性审核机制
- 应急响应预案

## 15. 后续扩展方向

1. 移动客户端开发
2. 资源智能推荐系统
3. 社区功能增强
4. 多语言支持
5. 内容创作者合作计划

## 16. 项目成功指标

1. 活跃用户数量增长率
2. VIP转化率
3. 用户留存率
4. 资源覆盖广度与深度
5. 系统稳定性指标

## 17. 其他补充建议

- **安全与合规**：注意数据安全、访问控制和合规性，敏感操作需有日志和异常处理。
- **测试优先**：鼓励 TDD/单元测试，保证核心业务逻辑的可验证性。
- **持续集成**：建议集成 CI 工具，自动化构建、测试和部署。
- **代码评审**：推行代码评审制度，提升代码质量和团队协作。

---

> 本文档为影视资源下载网站后端完整文档，整合了架构设计、业务需求、技术规范等所有重要内容，适用于项目的整个生命周期。