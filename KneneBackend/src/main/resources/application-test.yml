# 测试环境配置
# @author mosctz
# @version 1.0

spring:
  # 数据库配置 - 测试环境
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    type: com.zaxxer.hikari.HikariDataSource
    username: sa
    password:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # H2数据库控制台
  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        web-allow-others: true

  # Flyway配置 - 测试环境
  flyway:
    enabled: true
    locations: classpath:db/migration/test
    baseline-on-migrate: true

  # Redis配置 - 测试环境（使用嵌入式Redis）
  data:
    redis:
      host: localhost
      port: 6379
      password:
      database: 1

  # Elasticsearch配置 - 测试环境
  elasticsearch:
    rest:
      uris: http://localhost:9201
      username:
      password:

  # RocketMQ配置 - 测试环境
  rocketmq:
    name-server: localhost:9876
    producer:
      group: knene-test-producer-group
    consumer:
      group: knene-test-consumer-group

  # MinIO配置 - 测试环境
  minio:
    endpoint: http://localhost:9001
    access-key: minioadmin
    secret-key: minioadmin
    bucket-name: knene-test-resources
    secure: false

  # 缓存配置 - 测试环境
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=100,expireAfterWrite=1m

  # JPA配置 - 测试环境
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

# 服务器配置 - 测试环境
server:
  port: 8081

# 日志配置 - 测试环境
logging:
  level:
    com.knene: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN
    com.baomidou.mybatisplus: INFO
    org.testcontainers: INFO
    root: WARN

# 监控配置 - 测试环境
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# 应用自定义配置 - 测试环境
app:
  # JWT配置 - 测试环境
  jwt:
    secret: testSecretKey123456789
    expiration: 3600 # 1小时

  # 文件存储配置 - 测试环境
  storage:
    local:
      enabled: true
      path: ./uploads/test

  # 爬虫配置 - 测试环境
  crawler:
    enabled: false # 测试环境关闭爬虫
    thread-pool-size: 1

  # 限流配置 - 测试环境
  rate-limit:
    enabled: true
    default-limit: 1000
    window-size: 60s

# 测试环境特定配置
  test:
    database:
      replace: none